<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Sollicitaties</title>
    <script
            src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous">
    </script>
</head>
<body>
<div class="content">
    <h1>Sollicitaties</h1>
    <section id="gallery">
        <div class="container">
            <div class="row">
                <div th:each="task : ${tasks}">
                    <table id="sollicitaties">

                        <th:fieldset>
<!--                            <form action="#" th:action="@{/sollicitaties}" th:object="${task}" id="applicationform" method="get">-->
                                <form action="#" id="applicationform" th:action="@{/manager/saveSollicitaties/{status}}" th:object="${task}" method="get">
                            <tr>
                                <td id = "taskTitle" th:text="${task.titel}"></td>
                                <td id = "userName" th:each="user : ${task.users}">
                                <span th:text="${user.username}"></span></td>
                                <td th:text ="${task.getTaskStatus()}"></td>
                                <td>
                                    <select name="status" id="status" required>
                                    <option value="">Geef status</option>
                                        <span th:each="status : ${statussen}">
                                    <option th:text="${status}" th:value="${status}"></option></span>
                                    </select>
                                </td>
                            </tr>
                             </form>
                                <td>

                                    <button type="submit" value="Opslaan" id="opslaanSolliciatie"></button>

                                </td>


                        </th:fieldset>


                     </table>

                </div>

            </div>
            </form>
        </div>
</section>
</div>

<script>

        var button = document.getElementById("opslaanSolliciatie").addEventListener("click", opslaan);

        function opslaan () {

            var taskTitle = document.getElementById("taskTitle").value;
            var userName = document.getElementById("userName").value;
            var statusTask = $(this).find(':selected').text();

            var url = "/manager/saveSollicitaties/{status}";

            var request = new XMLHttpRequest();
            request.open('GET', url, true);
            request.setRequestHeader('Content-Type', 'application/json');
            request.setRequestHeader('Accept', 'application/json');

            var data = {taskTitle, userName, statusTask};

            console.log (JSON.stringify(data))

            request.send(JSON.stringify(data));

            request.onreadystatechange = function() {

                if(request.readyState === XMLHttpRequest.DONE){

                    if(request.status === 200)
                        {console.log(request.response);

                            var responseObject = JSON.parse(request.response);
                            console.log(responseObject);
                    } else {
                        alert("iets ging fout")
                    }
                    }
                }
        }

            // $("#applicationform").on("change", function () {
            //
            //     var formData = {
            //         taskTitle: $("#taskTitle").val(),
            //         userName: $("#userName").val(),
            //         statusTask: $(this).find(':selected').text();
            //
            // }
            //     payload = JSON.stringify(formData);
            //
            //     $.ajax({
            //         type: "get",
            //         contentType: "application/json; charset=utf-8",
            //         url: "/manager/saveSollicitaties/{status}",
            //         dataType: "json",
            //         data: payload
            //     }).done(function (response) {
            //             console.log (response)
            //         })
            // });
</script>
</body>
</html>